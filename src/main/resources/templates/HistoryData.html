<!DOCTYPE html>
<html lang="zh" xmlns="http://www.w3.org/1999/html">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>后端分页</title>
    <link href="/css/icon.css" type="text/css" rel="stylesheet">
    <link href="/css/myStyle.css" type="text/css" rel="stylesheet">
    <link href="/css/myStyle1.css" type="text/css" rel="stylesheet">
    <link href="/css/myStyle2.css" type="text/css" rel="stylesheet">
    <link href="/css/materialdesignicons.min.css" rel="stylesheet">
    <!--时间选择插件-->
    <!--日期选择插件-->
    <link rel="stylesheet" href="/css/bootstrap-datepicker.css">
    <link href="/css/style.min.css" rel="stylesheet">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/main.min.js"></script>
    <script type="text/javascript" src="/js/moment.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/echarts.min.js"></script>
    <!--时间选择器-->
    <script type="text/javascript" src="/js/zh-cn.js"></script>
    <!--日期选择器-->
    <script type="text/javascript" src="/js/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap-datepicker.zh-CN.min.js"></script>
    <script type="text/javascript" src="/js/jquery.cookie.min.js"></script>
    <script>
        var zoneId;
        var num;
        var startTime;
        var endTime;
        $(function () {
            console.log($.cookie('zoneId'));
            if ($.cookie('zoneId') !== '0') {
                zoneId = $.cookie('zoneId');
                $("#searchText_hd").val(zoneId);
                document.getElementById("searchText_hd").setAttribute('readOnly', true);
            }
            hd_searchAllPart();
        });

        function hd_drop_down_event(value) {
            document.getElementById("hd_part1_1_1").style.display = "none";
            document.getElementById("hd_part1_1_2").style.display = "none";
            document.getElementById("hd_part1_1_3").style.display = "none";
            document.getElementById("hd_part1_1_4").style.display = "none";
            if (value === "weekQuery") {
                document.getElementById("hd_part1_1_1").style.display = "";
            } else if (value === "monthQuery") {
                document.getElementById("hd_part1_1_2").style.display = "";
            } else if (value === "yearQuery") {
                document.getElementById("hd_part1_1_3").style.display = "";
            } else if (value === "ownQuery") {
                document.getElementById("hd_part1_1_4").style.display = "";

            }

        }

        function hd_searchAllPart() {
            part1Chart_hd();
        }

        function part1Chart_hd() {
            inputAssignment();
            var selectObject = document.getElementById("hd_select");
            var selectValue = selectObject.options[selectObject.selectedIndex].value;
            var urlString;
            if (selectValue === 'weekQuery') {
                urlString = "/historyData/queryByWeek.do";
                num = $('#hd_part1_1_1_input').val();
            } else if (selectValue === 'monthQuery') {
                urlString = "/historyData/queryByMonth.do";
                num = $('#hd_part1_1_2_input').val();
            } else if (selectValue === 'yearQuery') {
                urlString = "/historyData/queryByYear.do";
                num = $('#hd_part1_1_3_input').val();
            } else if (selectValue === 'ownQuery') {
                urlString = "/historyData/queryByUserDefined.do";
                startTime = $("#hd_part1_1_4_startTime").val();
                endTime = $("#hd_part1_1_4_endTime").val();
                if (startTime === "" || endTime === "" || startTime > endTime) {
                    alert("日期输入错误");
                    return;
                }
            } else {
                urlString = "/historyData/queryRecentSevenDays.do";
            }

            $.ajax({
                url: urlString,
                type: "post",
                dataType: "json",
                data: {"zoneId": zoneId, "num": num, "startTime": startTime, "endTime": endTime},
                success: function (data) {
                    fillPart1_hd(data);
                },
                error: function (msg) {
                    alert("ajax连接异常：" + msg);
                }
            });

        }

        //填充数据第一部分
        function fillPart1_hd(data) {
            var myChart = echarts.init(document.getElementById('hd_part1_2'));
            var waterTemperature = new Array(data.result.length / 7);
            var ph = new Array(data.result.length / 7);
            var cod = new Array(data.result.length / 7);
            var nh3 = new Array(data.result.length / 7);
            var dox = new Array(data.result.length / 7);
            var conductivity = new Array(data.result.length / 7);
            var turbidity = new Array(data.result.length / 7);
            var xAxisData = new Array(data.result.length / 7);
            // 指定图表的配置项和数据
            hd_paramToArray(data, xAxisData, waterTemperature, ph, cod, nh3, dox, conductivity, turbidity);
            var option = {
                grid: {
                    left: 60,
                    right: 60,
                    height: '70%',
                    bottom: 60
                },
                title: {
                    text: ""
                },
                tooltip: {},
                legend: {
                    top: 10,
                    data: ['水温', 'PH', '耗氧量', '氨氮', '溶解氧', '电导率', '浊度'],
                    selected: {
                        'PH': true,
                        '耗氧量': true,
                        '氨氮': true,
                        '溶解氧': true,
                        '电导率': true,
                        '浊度': true
                    }
                },
                xAxis: {
                    data: xAxisData,
                    axisLabel: {
                        interval: 0,
                        rotate: 0
                    }
                },
                yAxis: {},
                series: [{
                    name: '水温',
                    type: 'line',
                    data: waterTemperature
                }, {
                    name: 'PH',
                    type: 'line',
                    data: ph

                }, {
                    name: '耗氧量',
                    type: 'line',
                    data: cod
                }, {
                    name: '氨氮',
                    type: 'line',
                    data: nh3
                }, {
                    name: '溶解氧',
                    type: 'line',
                    data: dox
                }, {
                    name: '电导率',
                    type: 'line',
                    data: conductivity
                }, {
                    name: '浊度',
                    type: 'line',
                    data: turbidity
                }]
            };
            // 使用刚指定的配置项和数据显示图表。
            var myChartxAxisData = option.xAxis.data;
            if (myChartxAxisData.length >= 8) {
                option.xAxis.axisLabel.interval = 0;
                option.xAxis.axisLabel.rotate = 50;
            }
            myChart.setOption(option);
        }

        function hd_paramToArray(data, xAxisData, waterTemperature, ph, cod, nh3, dox, conductivity, turbidity) {
            for (var i = 0, j = 0; i < data.result.length; i = i + 7, j++) {
                waterTemperature[j] = data.result[i].avgData;
                xAxisData[j] = data.result[i].sendTime;
                ph[j] = data.result[i + 1].avgData;
                cod[j] = data.result[i + 2].avgData;
                nh3[j] = data.result[i + 3].avgData;
                dox[j] = data.result[i + 4].avgData;
                conductivity[j] = data.result[i + 5].avgData;
                turbidity[j] = data.result[i + 6].avgData;
            }
        }

        function inputAssignment() {
            if ($('#searchText_hd').val() == null || $('#searchText_hd').val() == '') {
                zoneId = 1;
            } else {
                zoneId = $('#searchText_hd').val();
            }
        }

    </script>
</head>
<body>
<div class="hd_card1" id="part1">
    <div class="hd_mySearch" id="hd_part1_1">
        <input type="text" placeholder="输入区域号" id="searchText_hd">
        <select id="hd_select" class="hd_drop_down_box"
                onclick="hd_drop_down_event(this.options[this.selectedIndex].value);">
            <option disabled="disabled" selected="selected">查询类型</option>
            <option value="weekQuery">按周查询</option>
            <option value="monthQuery">按月查询</option>
            <option value="yearQuery">按年查询</option>
            <option value="ownQuery">自定义查询</option>
        </select>
        <div class="dynamicDisplay">
            <div id="hd_part1_1_1" style="display: none;padding-left: 40px">
                <h6 style="display: inline">近</h6>
                <input id="hd_part1_1_1_input" style="display: inline;width: 50px;margin-left: 5px" placeholder='输入数字'/>
                <h6 style="display: inline">&nbsp;周</h6>
            </div>
            <div id="hd_part1_1_2" style="display: none;padding-left: 40px">
                <h6 style="display: inline">近</h6>
                <input id="hd_part1_1_2_input" style="display: inline;width: 50px;margin-left: 5px" placeholder='输入数字'/>
                <h6 style="display: inline">&nbsp;月</h6>
            </div>
            <div id="hd_part1_1_3" style="display: none;padding-left: 40px">
                <h6 style="display: inline">近</h6>
                <input id="hd_part1_1_3_input" style="display: inline;width: 50px;margin-left: 5px" placeholder='输入数字'/>
                <h6 style="display: inline">&nbsp;年</h6>
            </div>

            <div class="dynamicDisplay_detail" id="hd_part1_1_4" style="display:none;">
                <input class="js-datepicker " id="hd_part1_1_4_startTime"
                       name="example-datepicker" placeholder="开始日期" value=""
                       data-date-format="yyyy-mm-dd"
                       style="width: 70px;text-align: center;margin-left: 20px"/>
                <input placeholder="至"
                       style="width: 15px;background-color: #f9fafb;border-left-color:#f9fafb ;border-right-color: #f9fafb;margin-left: 0px"
                       disabled="disabled"/>
                <input class="js-datepicker " id="hd_part1_1_4_endTime"
                       name="example-datepicker" placeholder="结束日期" value="" data-date-format="yyyy-mm-dd"
                       style="width: 70px;text-align: center;margin-left: 0"/>
            </div>
        </div>
        <button class="btn btn-info btn-xs" type="button" onclick="hd_searchAllPart()">查询</button>
    </div>
    <div id="hd_part1_2" style="height: 420px;width: 980px;">

    </div>
</div>
</body>

</html>
