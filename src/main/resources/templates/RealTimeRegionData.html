<!DOCTYPE html>
<html lang="zh" xmlns="http://www.w3.org/1999/html">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>后端分页</title>
    <link href="/css/easyui.css" type="text/css" rel="stylesheet">
    <link href="/css/icon.css" type="text/css" rel="stylesheet">
    <link href="/css/myStyle.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="/js/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="/js/jquery.cookie.min.js"></script>
    <script>
        var ccurPage = 1;
        var zoneId;
        var orderStatus = 1;
        document.getElementById("curPage").value = ccurPage;
        $(function () {
            console.log($.cookie('zoneId'));
            if ($.cookie('zoneId') !== '0') {
                zoneId = $.cookie('zoneId');
                console.log(zoneId);
                $("#searchText").val(zoneId);
                document.getElementById("searchText").setAttribute('readOnly', true);

            }
            judgePrePageButtonStatus();
            realTimeQuery();
            part1Chart();
            part2Chart();
        });

        function judgePrePageButtonStatus() {
            if (ccurPage <= 1) {
                document.getElementById("prePageButton").disabled = true;
            } else {
                document.getElementById("prePageButton").disabled = false;
            }
        }

        function inputAssignment() {
            if ($('#searchText').val() == null || $('#searchText').val() == '') {
                zoneId = 1;
            } else {
                zoneId = $('#searchText').val();
            }
        }

        function fillTable(data) {
            /*这个方法里是ajax发送请求成功之后执行的代码*/
            var str = "";//定义用于拼接的字符串
            $("#tab tbody").remove();
            for (var i = 0; i < data.result.length; i++) {
                //拼接表格的行和列
                str = "<tbody><tr><td>" + data.result[i].zoneId +
                    "</td><td>" + data.result[i].waterTemperature +
                    "</td><td>" + data.result[i].ph +
                    "</td><td>" + data.result[i].cod +
                    "</td><td>" + data.result[i].nh3 +
                    "</td><td>" + data.result[i].dox +
                    "</td><td>" + data.result[i].conductivity +
                    "</td><td>" + data.result[i].turbidity +
                    "</td><td>" + data.result[i].sendTime +
                    "</td></tr></tbody>";
                //追加到table中
                $("#tab").append(str);

            }
            if (data.result.length < 6) {
                document.getElementById("nextPageButton").disabled = true;
            } else {
                document.getElementById("nextPageButton").disabled = false;
            }
        }

        function realTimeQuery() {
            orderStatus = 1;
            var btn1 = document.getElementById("ascOrder");
            var btn2 = document.getElementById("descOrder");
            btn1.style.borderColor = "transparent transparent #34baff";
            btn2.style.borderColor = "transparent transparent #868e96";
            inputAssignment();
            $.ajax({
                url: "/realTimeRegionData/queryPaginationTodayMessage.do",
                type: "post",
                dataType: "json",
                data: {"zoneId": zoneId, "startNum": (ccurPage - 1) * 6, "limitNum": 6},
                success: function (data) {
                    fillTable(data);
                },
                error: function (msg) {
                    alert("ajax连接异常：" + msg);
                }
            });
        }

        function realTimeQueryDesc() {
            orderStatus = 0;
            var btn1 = document.getElementById("ascOrder");
            var btn2 = document.getElementById("descOrder");
            btn1.style.borderColor = "transparent transparent #868e96";
            btn2.style.borderColor = "transparent transparent #34baff";
            inputAssignment();
            $.ajax({
                url: "/realTimeRegionData/queryPaginationTodayMessageDescend.do",
                type: "post",
                dataType: "json",
                data: {"zoneId": zoneId, "startNum": (ccurPage - 1) * 6, "limitNum": 6},
                success: function (data) {
                    fillTable(data);
                },
                error: function (msg) {
                    alert("ajax连接异常：" + msg);
                }
            });
        }

        function nextPage() {
            var tempUrl;
            if (orderStatus.valueOf() == 1) {
                tempUrl = "/realTimeRegionData/queryPaginationTodayMessage.do";
            } else {
                tempUrl = "/realTimeRegionData/queryPaginationTodayMessageDescend.do";
            }
            inputAssignment();
            ccurPage++;
            judgePrePageButtonStatus();
            document.getElementById("curPage").value = ccurPage;
            $.ajax({
                url: tempUrl,
                type: "post",
                dataType: "json",
                data: {"zoneId": zoneId, "startNum": (ccurPage - 1) * 6, "limitNum": 6},
                success: function (data) {
                    fillTable(data);
                },
                error: function (msg) {
                    alert("ajax连接异常：" + msg);
                }
            });
        }

        function prePage() {
            var tempUrl;
            if (orderStatus.valueOf() == 0) {
                tempUrl = "/realTimeRegionData/queryPaginationTodayMessageDescend.do";
            } else {
                tempUrl = "/realTimeRegionData/queryPaginationTodayMessage.do";
            }
            inputAssignment();
            ccurPage--;
            judgePrePageButtonStatus();
            document.getElementById("curPage").value = ccurPage;
            $.ajax({
                url: tempUrl,
                type: "post",
                dataType: "json",
                data: {"zoneId": zoneId, "startNum": (ccurPage - 1) * 6, "limitNum": 6},
                success: function (data) {
                    fillTable(data);
                },
                error: function (msg) {
                    alert("ajax连接异常：" + msg);
                }
            });
        }

        function part3Search() {
            ccurPage = 1;
            document.getElementById("curPage").value = ccurPage;
            judgePrePageButtonStatus();
            realTimeQuery();
        }
    </script>
    <script>
        function searchAllPart() {
            part1Chart();
            part2Chart();
            part3Search();
        }

        function part1Chart() {
            inputAssignment();
            $.ajax({
                url: "/realTimeRegionData/queryTodayMessage.do",
                type: "post",
                dataType: "json",
                data: {"id": zoneId},
                success: function (data) {
                    fillPart1(data);
                },
                error: function (msg) {
                    alert("ajax连接异常：" + msg);
                }
            });
        }

        function fillPart1(data) {
            var myChart = echarts.init(document.getElementById('part12'));
            var waterTemperature = new Array(data.result.length);
            var ph = new Array(data.result.length);
            var cod = new Array(data.result.length);
            var nh3 = new Array(data.result.length);
            var dox = new Array(data.result.length);
            var conductivity = new Array(data.result.length);
            var turbidity = new Array(data.result.length);
            // 指定图表的配置项和数据
            paramToArray(data, waterTemperature, ph, cod, nh3, dox, conductivity, turbidity);
            var option = {
                grid: {
                    left: 60,
                    right: 60,
                    height: '60%',
                    bottom: 45
                },
                title: {
                    text: ''
                },
                tooltip: {},
                legend: {
                    top: 10,
                    data: ['水温', 'PH', '耗氧量', '氨氮', '溶解氧', '电导率', '浊度'],
                    selected: {
                        'PH': false,
                        '耗氧量': false,
                        '氨氮': false,
                        '溶解氧': false,
                        '电导率': false,
                        '浊度': false
                    }
                },
                xAxis: {
                    data: ["0", "1", "2", "3", "4", "5",
                        "6", "7", "8", "9", "10", "11",
                        "12", "13", "14", "15", "16", "17",
                        "18", "19", "20", "21", "22", "23"]
                },
                yAxis: {},
                series: [{
                    name: '水温',
                    type: 'line',
                    data: waterTemperature
                }, {
                    name: 'PH',
                    type: 'line',
                    data: ph
                }, {
                    name: '耗氧量',
                    type: 'line',
                    data: cod
                }, {
                    name: '氨氮',
                    type: 'line',
                    data: nh3
                }, {
                    name: '溶解氧',
                    type: 'line',
                    data: dox
                }, {
                    name: '电导率',
                    type: 'line',
                    data: conductivity
                }, {
                    name: '浊度',
                    type: 'line',
                    data: turbidity
                }]
            };
            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
        }

        function paramToArray(data, waterTemperature, ph, cod, nh3, dox, conductivity, turbidity) {
            for (var i = 0; i < data.result.length; i++) {
                waterTemperature[i] = data.result[i].waterTemperature;
                ph[i] = data.result[i].ph;
                cod[i] = data.result[i].cod;
                nh3[i] = data.result[i].nh3;
                dox[i] = data.result[i].dox;
                conductivity[i] = data.result[i].conductivity;
                turbidity[i] = data.result[i].turbidity;
            }
        }

    </script>
    <script>
        function part2Chart() {
            inputAssignment();
            $.ajax({
                url: "/realTimeRegionData/queryDataStatistics.do",
                type: "post",
                dataType: "json",
                data: {"zoneId": zoneId},
                success: function (data) {
                    fillPart2(data);
                    fillPart4(data);
                },
                error: function (msg) {
                    alert("ajax连接异常：" + msg);
                }
            });
        }

        function fillPart2(data) {
            var myChart = echarts.init(document.getElementById('part22'));
            var maxData = new Array();
            var minData = new Array();
            // 指定图表的配置项和数据
            paramToArray1(data, maxData, minData);
            var option = {
                grid: {
                    left: 45,
                    right: 20,
                    height: '80%',
                    bottom: 20
                },
                title: {
                    text: ''
                },
                tooltip: {},
                legend: {
                    top: 0,
                    data: ['最大值', '最小值']
                },
                xAxis: {},
                yAxis: {
                    data: ['水温', 'PH', '耗氧量', '氨氮', '溶解氧', '电导率', '浊度']
                },
                series: [{
                    name: '最大值',
                    type: 'bar',
                    data: maxData
                }, {
                    name: '最小值',
                    type: 'bar',
                    data: minData
                }]
            };
            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
        }

        function paramToArray1(data, maxData, minData) {
            var obj = data.result;
            maxData[0] = obj.water_temperature.maxData;
            maxData[1] = obj.ph.maxData;
            maxData[2] = obj.cod.maxData;
            maxData[3] = obj.nh3.maxData;
            maxData[4] = obj.dox.maxData;
            maxData[5] = obj.conductivity.maxData;
            maxData[6] = obj.turbidity.maxData;
            minData[0] = obj.water_temperature.minData;
            minData[1] = obj.ph.minData;
            minData[2] = obj.cod.minData;
            minData[3] = obj.nh3.minData;
            minData[5] = obj.dox.minData;
            minData[4] = obj.conductivity.minData;
            minData[6] = obj.turbidity.minData;
        }


    </script>
    <script>
        function fillPart4(data) {
            var obj = data.result;
            var dom1 = document.getElementById("avg_water_temperature");
            dom1.innerHTML = "<span style=\"color:black;\">水温:</span>" + obj.water_temperature.avgData;
            dom1.style.color = "#228b22";
            var dom2 = document.getElementById("avg_ph");
            dom2.innerHTML = "<span style=\"color:black;\">PH:</span>" + obj.ph.avgData;
            dom2.style.color = "#228b22";
            var dom3 = document.getElementById("avg_cod");
            dom3.innerHTML = "<span style=\"color:black;\">耗氧量:</span>" + obj.cod.avgData;
            dom3.style.color = "#228b22";
            var dom4 = document.getElementById("avg_nh3");
            dom4.innerHTML = "<span style=\"color:black;\">氨氮:</span>" + obj.nh3.avgData;
            dom4.style.color = "#228b22";
            var dom5 = document.getElementById("avg_dox");
            dom5.innerHTML = "<span style=\"color:black;\">溶解氧:</span>" + obj.dox.avgData;
            dom5.style.color = "#228b22";
            var dom6 = document.getElementById("avg_conductivity");
            dom6.innerHTML = "<span style=\"color:black;\">电导率:</span>" + obj.conductivity.avgData;
            dom6.style.color = "#228b22";
            var dom7 = document.getElementById("avg_turbidity");
            dom7.innerHTML = "<span style=\"color:black;\">浊度:</span>" + obj.turbidity.avgData;
            dom7.style.color = "#228b22";
            var dom8 = document.getElementById("sum_water_temperature");
            dom8.innerHTML = "<span style=\"color:black;\">水温:</span>" + obj.water_temperature.sumData;
            dom8.style.color = "#228b22";
            var dom9 = document.getElementById("sum_ph");
            dom9.innerHTML = "<span style=\"color:black;\">PH:</span>" + obj.ph.sumData;
            dom9.style.color = "#228b22";
            var dom10 = document.getElementById("sum_cod");
            dom10.innerHTML = "<span style=\"color:black;\">耗氧量:</span>" + obj.cod.sumData;
            dom10.style.color = "#228b22";
            var dom11 = document.getElementById("sum_nh3");
            dom11.innerHTML = "<span style=\"color:black;\">氨氮:</span>" + obj.nh3.sumData;
            dom11.style.color = "#228b22";
            var dom12 = document.getElementById("sum_dox");
            dom12.innerHTML = "<span style=\"color:black;\">溶解氧:</span>" + obj.dox.sumData;
            dom12.style.color = "#228b22";
            var dom13 = document.getElementById("sum_conductivity");
            dom13.innerHTML = "<span style=\"color:black;\">电导率:</span>" + obj.conductivity.sumData;
            dom13.style.color = "#228b22";
            var dom14 = document.getElementById("sum_turbidity");
            dom14.innerHTML = "<span style=\"color:black;\">浊度:</span>" + obj.turbidity.sumData;
            dom14.style.color = "#228b22";
        }
    </script>
</head>
<body>
<div class="r_card1" id="part1">
    <div class="mySearch">
        <input type="text" placeholder="输入区域号" id="searchText">
        <button class="btn btn-info btn-xs" type="button" onclick="searchAllPart()">查询</button>
    </div>
    <div id="part12" style="height: 210px;width: 700px;">
    </div>
</div>
<div class="r_card2" id="part2">
    <div id="part22" style="height: 220px;width: 320px;">
    </div>
</div>
<div class="r_card1" id="part3">
    <table class="table1 table-bordered" id="tab">
        <thead>
        <tr>
            <td width="60">区域号</td>
            <td width="70">水温</td>
            <td width="70">PH</td>
            <td width="70">耗氧量</td>
            <td width="70">氨氮</td>
            <td width="70">溶解氧</td>
            <td width="70">电导率</td>
            <td width="70">浊度</td>
            <td width="130">发送时间
                <!--上面的箭头，升序-->
                <i class="angle_top" onclick="realTimeQuery()" id="ascOrder"></i>
                <!--下面的箭头，降序-->
                <i class="angle_bottom" onclick="realTimeQueryDesc()" id="descOrder"></i>
            </td>
        </tr>
        </thead>
    </table>
    <div class="myPage">
        <button class="btn btn-default btn-xs" type="button"
                onclick="prePage()" id="prePageButton">上一页
        </button>
        <input class="btn btn-info btn-xs" type="button" id="curPage"/>
        <button class="btn btn-default btn-xs" type="button"
                onclick="nextPage()" id="nextPageButton">下一页
        </button>
    </div>
</div>
<div class="r_card2" id="part4">
    <h6>数据分析</h6>
    <div class="part4">
        <div class="part4_1" id="part4_1">
            <p class="part4_3 link-bottom">平均数据</p>
            <p class="part4_3 link-bottom" id="avg_water_temperature"></p>
            <p class="part4_3 link-bottom" id="avg_ph"></p>
            <p class="link-bottom" id="avg_cod"></p>
            <p class="link-bottom" id="avg_nh3"></p>
            <p class="link-bottom" id="avg_dox"></p>
            <p class="link-bottom" id="avg_conductivity"></p>
            <p class="link-bottom" id="avg_turbidity"></p>
        </div>
        <div class="part4_2" id="part4_2">
            <p class="part4_3 link-bottom">累加数据</p>
            <p class="part4_3 link-bottom" id="sum_water_temperature"></p>
            <p class="part4_3 link-bottom" id="sum_ph"></p>
            <p class="link-bottom" id="sum_cod"></p>
            <p class="link-bottom" id="sum_nh3"></p>
            <p class="link-bottom" id="sum_dox"></p>
            <p class="link-bottom" id="sum_conductivity"></p>
            <p class="link-bottom" id="sum_turbidity"></p>
        </div>
    </div>
</div>
</body>

</html>
